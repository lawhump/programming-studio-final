function initMap(){app.Map=new app.views.Map}var app=function(){var e={views:{},models:{},collections:{},LoginView:null,init:function(){return this.LoginView=new app.views.Login,this}};return console.log("initializing app"),e}();$(document).ready(function(){app.init();var e=location.origin.replace(/^http/,"ws"),n=new WebSocket(e);app.ws=n,n.onmessage=function(e){app.Feed.update(e)}}),$(".fab").on("click",function(){app.LoginView.render()}),$(window).on("resize",function(){var e=$(window).height(),n=0;$("#map").css("height",e-n)}).resize();var app=app||{};!function(){"use strict";app.models.User=Backbone.Model.extend({location:null,username:"Guapo15",init:function(){}}),app.User=new app.models.User}();var app=app||{};!function(){"use strict";var e=Backbone.Collection.extend({model:app.models.User,nextOrder:function(){return this.length?this.last().get("order")+1:1},updateWithNewComment:function(){console.log("fuck"),app.CommitInfoView.render()},comparator:"order"});app.Users=new e,console.log("initializing users collection")}();var app=app||{};!function(){"use strict";app.views.Login=Backbone.View.extend({events:{"click #submit":"addUser","keypress #username":"keypressHandler"},el:"#myModal",initialize:function(){this.song=null,this.render()},render:function(){$("#myModal").modal("show")},addUser:function(){var e=document.getElementById("username"),n=e.value;$("#myModal").modal("hide");var o;app.Map.locationToLatLng(app.Map.place.formatted_address).then(function(e){o=e;var t=JSON.stringify({user:n,location:o});app.ws.send(t)},function(e){console.log("cussed uppppp")})},keypressHandler:function(e){var n=e.keyCode?e.keyCode:e.which;13==n&&this.addUser()}})}();var app=app||{};!function(){"use strict";app.views.Feed=Backbone.View.extend({events:{},initialize:function(){this.res=null,this.render()},render:function(){return this},update:function(e){console.log(e);var n=JSON.parse(e.data),o=JSON.parse(n.song),t=$("#feed-template").html(),a=Handlebars.compile(t),i={user:n.user,song:o.recenttracks.track[0].name,artist:o.recenttracks.track[0].artist["#text"]},s=a(i),p=$("#"+n.user);0!=p.length?p.replaceWith(s):app.Feed.$el.append(s),app.Map.updateMap(n)}}),app.Feed=new app.views.Feed({el:$(".feed")})}();var app=app||{};!function(){"use strict";app.views.Map=Backbone.View.extend({el:"#map",events:{},initialize:function(){this.infowindow=null,this.infowindows=[],this.place=null,this.marker=null,this.markers=[],this.map=null,this.image="images/user.png",this.initMap()},initMap:function(){this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.1058647,lng:-88.2193354},streetViewControl:!1,zoom:13});var e=document.getElementById("pac-input"),n=document.getElementById("type-selector");this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(n);var o=new google.maps.places.Autocomplete(e);o.bindTo("bounds",this.map),this.infowindow=new google.maps.InfoWindow,this.marker=new google.maps.Marker({icon:this.image,map:this.map,anchorPoint:new google.maps.Point(0,-29)}),o.addListener("place_changed",function(){return app.Map.infowindow.close(),app.Map.marker.setVisible(!1),app.Map.place=o.getPlace(),app.Map.place.geometry?void(app.Map.place.geometry.viewport?app.Map.map.fitBounds(app.Map.place.geometry.viewport):(app.Map.map.setCenter(app.Map.place.geometry.location),app.Map.map.setZoom(17))):void window.alert("Autocomplete's returned place contains no geometry")})},updateMap:function(e){console.log("in updateMap"),console.log(e),console.log(this.infowindows),console.log(this.markers);for(var n=-1,o=this.infowindows.length-1;o>=0;o--)this.infowindows[o].content.includes(e.user)&&(n=o);0>n?this.addUser(e):this.updateUser(e,n)},locationToLatLng:function(e){console.log(e);var n=$.Deferred(),o=new google.maps.Geocoder;return o.geocode({address:e},function(e,o){if(o==google.maps.GeocoderStatus.OK){console.log(e);var t={lat:e[0].geometry.location.lat(),lng:e[0].geometry.location.lng()};n.resolve(t)}else alert("Geocode was not successful for the following reason: "+o),n.reject(o)}),n.promise()},addUser:function(e){var n,o=JSON.parse(e.song),t=o.recenttracks.track[0].image[1]["#text"],a=o.recenttracks.track[0].name;n=null!=this.place?new google.maps.Marker({position:this.place.geometry.location,map:this.map}):new google.maps.Marker({position:e.location,map:this.map}),n.setIcon({url:t,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(50,50)}),this.markers.push(n);var i=new google.maps.InfoWindow;n.setPosition(new google.maps.LatLng(e.location)),n.setVisible(!0),i.setContent("<div><strong>"+e.user+"</strong><br>"+a),i.open(this.map,n),this.infowindows.push(i)},updateUser:function(e,n){var o=JSON.parse(e.song),t=o.recenttracks.track[0].image[1]["#text"],a=o.recenttracks.track[0].name,i=this.markers[n];i.setIcon({url:t,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(50,50)});var s=this.infowindows[n];i.setPosition(new google.maps.LatLng(e.location)),i.setVisible(!0),s.setContent("<div><strong>"+e.user+"</strong><br>"+a),s.open(this.map,i)}}),app.Map=new app.views.Map}();